{% extends "base.html" %}

{% block title %}The Open Source Report Card{% endblock %}

{% block body %}

<div class="hist-block">
    <div id="week" class="hist"></div>
    <div id="week-legend" class="hist"></div>
</div>

{% endblock %}

{% block scripts %}

<script src="{{ url_for(".static", filename="d3.v3.min.js") }}"></script>
<script src="{{ url_for(".static", filename="underscore-min.js") }}"></script>
<script src="{{ url_for(".static", filename="jquery-1.9.1.min.js") }}"></script>
<script src="{{ url_for(".static", filename="plot.js") }}"></script>
<script>

d3.json("{{ url_for(".static", filename="week_means.json") }}", function (data) {

    var keys = [];
    for (var k in data) {
        data[k] = data[k].map(function (d) { return [d]; });
        keys.push(k);
    }

    // Schedule histograms.
    var week_hist = window.histogram().width(200)
                                      .labels(["S","M","T","W","T","F","S"]);
    d3.select("#week").datum(data[keys[0]]).call(week_hist);

    // Week type legend.
    var svg = d3.select("#week-legend").append("svg")
                    .attr("width", 200)
                    .attr("height", 200)
                .append("g")
                    .attr("transform", "translate(0,30)");
    svg.selectAll("text").data(keys).enter().append("text")
        .attr("y", function (d, i) { return 15 * (i + 1); })
        .on("click", function (d) {
            var el = d3.select("#week");
            el.selectAll("svg").remove();
            el.data([data[d]]).call(week_hist);
            svg.selectAll("text").each(function () {
                d3.select(this).style("fill", function (d0) {
                    if (d0 === d) return "#1f77b4";
                    return "#222";
                });
            });
        })
        .style("cursor", "pointer")
        .style("fill", function (d, i) {
            if (i == 0) return "#1f77b4";
            return "#222";
        })
        .text(function (d) { return d; });

});

</script>

{% endblock %}
